/**
* Storyboard - v0.1.0 - 11/9/2015
* http://github.com/madebykind/storyboard
* Copyright (c) 2015 Alex Graul, Irene Ros, Rich Harris;
* Dual Licensed: MIT, GPL
* https://github.com/madebykind/storyboard/blob/master/LICENSE-MIT 
* https://github.com/madebykind/storyboard/blob/master/LICENSE-GPL 
*/!function(a,_){function b(a,b,c){this._transitioning=!0;var d=this._complete=c||RSVP.defer(),e=RSVP.defer(),f=b?b:[],g=_.bind(function(){this._transitioning=!1,this._current=a,d.resolve()},this),h=_.bind(function(){this._transitioning=!1,d.reject()},this);return e.promise.then(g,h),this.handlers[a].call(this._context,f,e),window.returnedProm=d.promise,d.promise}function c(a,b,c){var d=this.scenes[a],e=this._current,f=b?b:[],g=this._complete=c||RSVP.defer(),h=RSVP.defer(),i=RSVP.defer(),j=_.bind(function(a,b){var c=b?e:d,f=c?c.name:"";this.trigger(a,e,d),("start"!==a||"end"!==a)&&this.trigger(f+":"+a)},this),k=_.bind(function(){this._transitioning=!1,this._current=e,j("fail"),g.reject()},this),l=_.bind(function(){j("enter"),this._transitioning=!1,this._current=d,j("end"),g.resolve()},this);if(!d)throw'Scene "'+a+'" not found!';return this._transitioning?(g.reject(),g.promise):(j("start"),this._transitioning=!0,e?e.to("exit",f,h).then(function(){j("exit",!0)}):h.resolve(),h.promise.then(function(){d.to(d._initial||"enter",f,i)},k),i.promise.then(l,k),g.promise)}function d(a,b){if(!_.isFunction(a))return a;if(/^_/.test(b))return a;if(a.__wrapped)return a;var c=function(b,c){var d,e=!1;return c=c||RSVP.defer(),this.async=function(){return e=!0,function(a){return a!==!1?c.resolve():c.reject()}},d=a.apply(this,b),this.async=void 0,e?c.promise:d!==!1?c.resolve():c.reject()};return c.__wrapped=!0,c}var e=function(a){a=a||{},_.isArray(a["extends"])&&_.forEach(a["extends"],function(b){_.extend(a,b)}),this._originalOptions=a,this._context=a.context||this,this._id=_.uniqueId("scene"),a.scenes?(_.each(a.scenes,function(b,c){"function"==typeof b&&(a.scenes[c]={enter:b})}),_.each(e.HANDLERS,function(b){a.scenes[b]=a.scenes[b]||function(){return!0}}),this._buildScenes(a.scenes),this._initial=a.initial,this.to=c):(this.handlers={},_.each(e.HANDLERS,function(b){a[b]=a[b]||function(){return!0},this.handlers[b]=d(a[b],b)},this),this.to=b),_.each(a,function(a,b){-1===_.indexOf(e.BLACKLIST,b)&&(_.isFunction(a)?this[b]=function(b){return function(){a.apply(b._context||b,arguments)}}(this):this[b]=a)},this)};RSVP.EventTarget.mixin(e.prototype),e.HANDLERS=["enter","exit"],e.BLACKLIST=["_id","initial","scenes","enter","exit","context","_current"],_.extend(e.prototype,{clone:function(){return this.scenes&&_.each(this._originalOptions.scenes,function(a,b){a instanceof e&&(this._originalOptions.scenes[b]=a.clone())},this),new e(this._originalOptions)},attach:function(a,b){return this.name=a,this.parent=b,b._context&&b._context._id!==b._id&&(this._context=b._context,this.scenes&&_.each(this.scenes,function(a){a.attach(a.name,this)},this)),this},start:function(a){return a=a||[],a.unshift(this._initial),"undefined"!=typeof this._current?RSVP.defer().resolve():this.to.apply(this,a)},next:function(){return this._sequence("next")},prev:function(){return this._sequence("prev")},_sequence:function(a,b){function c(){return b=b||RSVP.defer(),b.reject(),b.promise}var d=this._current,e=d[a+"Scene"];return d.scenes?d[a]():e?this.scenes[e]?this.to(e,[],b):this.parent&&this.parent.scenes[e]?this.parent.to(e,[],b):c():c()},cancelTransition:function(){this._complete.reject(),this._transitioning=!1},scene:function(){return this._current?this._current.name:null},is:function(a){return a===this._current.name},inTransition:function(){return this._transitioning===!0},setContext:function(a){this._context=a,this.scenes&&_.each(this.scenes,function(b){b.setContext(a)})},_buildScenes:function(a){this.scenes={},_.each(a,function(a,b){this.scenes[b]=a instanceof e?a:new e(a),this.scenes[b].attach(b,this)},this)},deferred:function(){return RSVP.defer()}}),a.Storyboard=e}(this,_);